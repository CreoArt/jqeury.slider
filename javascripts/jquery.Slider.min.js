(function($){$.fn.Slider=function(s){var $this=this,s=$.extend({next_bt:".next",prev_bt:".prev",bt_hide:false,type:false,hs:false,duration:1e3,debug:false,animating:false},s);$this.windowLoaded=false;$this.ul=$("ul:first",this);$this.li=$("li",$this.ul);$this.lif=$("li:first",$this.ul);$this.idx=0;$this.id=$(this).attr("id");$this.next_bt=$(s.next_bt,this);$this.prev_bt=$(s.prev_bt,this);$this.hh=0;$this.ulw=0;$this.ulfw=0;$this.obj=0;$this.objr=0;$this.liw=0;var make=function(){if(s.bt_hide)$this.prev_bt.hide();$this.setup=function(){$this.windowLoaded=true;if(s.debug){console.log("--- Slider setup ---");console.log("id: "+$this.id);console.log("--- Settings ---");console.log(s);if(s.type=="gallary")console.log("gallary mode");console.log("li.length: "+$this.li.length);console.log("container & ul setup css")}$($this).css({overflow:"hidden",position:"relative"});$this.ul.css({padding:"0","list-style":"none",overflow:"hidden",position:"relative","float":"left",width:"9999px"});$this.ulfw=$($this).outerWidth()-$this.next_bt.outerWidth()-$this.prev_bt.outerWidth();if(s.debug){console.log("container width: "+$($this).outerWidth());console.log("next bottom width: "+$this.next_bt.outerWidth());console.log("prev bottom width: "+$this.prev_bt.outerWidth());console.log("ul factory width: "+$this.ulfw)}if(s.debug)console.log("li setup css and max height");$this.li.each(function(){if($this.hh<$(this).outerHeight(true))$this.hh=$(this).outerHeight(true);$(this).css({padding:"0",margin:"0","list-style":"none",position:"relative","float":"left"});if(s.type=="gallary"){$(this).addClass("gl_"+$this.id);$(this).attr("rel","gl_"+$this.id+"_"+$this.idx);$(this).css("cursor","pointer");$(this).click($this.gallary);$this.idx++}});$this.obj=Math.ceil($this.ulfw/$this.li[0].clientWidth);$this.objr=$this.ulfw/$this.li[0].clientWidth;if(s.debug){console.log("Obj: "+$this.obj);console.log("Objr: "+$this.objr)}if(s.hs){if(s.debug)console.log("li max height: "+$this.hh);$(this).height($this.hh)}};$this.overlay=function(e,t,n){var e=$.extend({width:"auto",height:"auto",close:true,type:false,style:"",idx:false},e),r="",i="",s="";if(e.type=="gallary"){i='<div id="SliderOverlayNext" style="position:absolute;top:0;bottom:0;right:-20px;background: url(\'images/slider-next.png\') right center no-repeat; width:70px;cursor:pointer;" rel="'+e.idx+'"></div>';s='<div id="SliderOverlayPrev" style="position:absolute;top:0;bottom:0;left:-20px;background: url(\'images/slider-prev.png\') left center no-repeat; width:70px;cursor:pointer;" rel="'+e.idx+'"></div>'}if(e.close)r='<img id="SliderOverlayClose" style="position:absolute;top:-24px;right:-24px;z-index:1002;cursor:pointer;" src="images/slider-close.png">';if($("#SliderOverlay").html()==null)$("body").append('<div id="SliderOverlay" style="position:fixed;top:0;bottom:0;left:0;right:0;background:#000;opacity:0.5;z-index:1000;"></div>');if($("#SliderOverlayBox").html()==null){$("body").append('<div id="SliderOverlayBox" style="display:none;position:fixed;top:50%;left:50%;background:#fff;z-index:1001;width:'+e.width+";height:"+e.height+";"+e.style+'">'+t+""+r+""+i+""+s+"</div>");$this.overlay_bind(e,n)}else{$("#SliderOverlayBox").css({width:e.width+"px",height:e.height+"px"});$("#SliderOverlayBox").html(t+""+r+""+i+""+s);$this.overlay_bind(e,n)}};$this.overlay_bind=function(e,t){$("#SliderOverlayBox").css({"margin-top":"-"+$("#SliderOverlayBox").outerHeight()/2+"px","margin-left":"-"+$("#SliderOverlayBox").outerWidth()/2+"px"});console.log($("#SliderOverlayBox").css("margin-top"));if(e.close){$("#SliderOverlay").click($this.overlay_close);$("#SliderOverlayClose").click($this.overlay_close)}if(e.type=="gallary"){$("#SliderOverlayNext").click($this.gallary_next);$("#SliderOverlayPrev").click($this.gallary_prev)}if($("#SliderOverlayBox").is(":hidden")){$("#SliderOverlayBox").show("slow",function(){if(t)t()})}else{if(t)t()}};$this.overlay_close=function(){$("#SliderOverlay").remove();$("#SliderOverlayBox").remove()};$this.gallary=function(){var e=$("img",$(this)).attr("rel"),t=$(this).attr("rel");$this.gallary_load(t,e)};$this.gallary_array=function(){var e=[];$(".gl_"+$this.id).each(function(){e.push($(this).attr("rel"))});return e};$this.gallary_prev=function(){var e=$this.gallary_array(),t=$(this).attr("rel");var n=e.indexOf(t);if(n==0)n=e.length-1;else n--;var r=$("img",$("li[rel='"+e[n]+"']")).attr("rel");$this.gallary_load(e[n],r)};$this.gallary_next=function(){var e=$this.gallary_array(),t=$(this).attr("rel");var n=e.indexOf(t);if(e.length-1<n+1)n=0;else n++;var r=$("img",$("li[rel='"+e[n]+"']")).attr("rel");$this.gallary_load(e[n],r)};$this.gallary_load=function(e,t){var n={style:"padding:20px;",close:false};$this.overlay(n,"<center>Подождите идет загрузка...</center>",function(){var n=new Image;n.onload=function(){var t={width:this.width,height:this.height,type:"gallary",idx:e};$this.overlay(t,'<img src="'+this.src+'" border="0">')};n.src=t+"?"+(new Date).getTime()})};$this.next=function(){if(s.animating||!$this.windowLoaded){return false}s.animating=true;var stop=0;var st="$(this)";var end=".animate({left: '-'+twh+'px'}, s.duration, function() { $(this).css('left','');});";$this.li.each(function(index){var twh=0;if($(this).css("display")!="none"&&index!=$this.li.length-1&&stop==0){if(index==$this.li.length-$this.obj-1&&s.bt_hide){$this.next_bt.hide()}if(index==$this.li.length){s.animating=false;return false}if($this.obj==$this.objr&&index==$this.li.length-$this.obj){s.animating=false;return false}for(var i=0;i<$this.obj;i++){st+=".next()";if(!eval(st+".html()")&&i<$this.obj-1){s.animating=false;return false}}twh=$(this).outerWidth(true);$(this).animate({left:"-"+twh+"px"},s.duration,function(){$(this).hide();s.animating=false});st="$(this)";for(var i=0;i<$this.obj;i++){st+=".next()";eval(st+end)}stop=1;if(s.bt_hide)$this.prev_bt.show()}if($(this).css("display")!="none"&&index==$this.li.length-1&&stop==0){s.animating=false}});return false};$this.prev=function(){if(s.animating||!$this.windowLoaded){return false}s.animating=true;var lihl=$("li:hidden:last",$this.ul),linhf=$("li:not(:hidden):first",$this.ul);if($("li:hidden",$this.ul).length==0&&!s.bt_hide){s.animating=false;return false}var twh=lihl.outerWidth(true);lihl.show();lihl.animate({left:"0px"},1e3,function(){$(this).css("left","");s.animating=false});var st="linhf";var end=".css('left','-'+twh+'px').animate({left: '0px'}, 1000, function() {$(this).css('left','');});";for(var i=0;i<$this.obj;i++){if(i!=0)st+=".next()";eval(st+end)}if($("li:hidden",$this.ul).length==0&&s.bt_hide)$this.prev_bt.hide();if(s.bt_hide)$this.next_bt.show();return false};$this.next_bt.click($this.next);$this.prev_bt.click($this.prev);$(window).load(function(){$this.setup()})};return this.each(make)}})(jQuery)